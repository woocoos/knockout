package graphql

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.26

import (
	"context"
	"strconv"

	"entgo.io/contrib/entgql"
	"github.com/woocoos/entco/pkg/identity"
	"github.com/woocoos/knockout/ent"
	"github.com/woocoos/knockout/ent/orgrole"
	"github.com/woocoos/knockout/ent/user"
)

// GlobalID is the resolver for the globalID field.
func (r *queryResolver) GlobalID(ctx context.Context, typeArg string, id int) (*string, error) {
	s, err := ent.GlobalID(typeArg, strconv.Itoa(id))
	return &s, err
}

// OrgGroups is the resolver for the orgGroups field.
func (r *queryResolver) OrgGroups(ctx context.Context, after *entgql.Cursor[int], first *int, before *entgql.Cursor[int], last *int, orderBy *ent.OrgRoleOrder, where *ent.OrgRoleWhereInput) (*ent.OrgRoleConnection, error) {
	tid, err := identity.TenantIDFromContext(ctx)
	if err != nil {
		return nil, err
	}
	return r.Client.OrgRole.Query().Where(orgrole.OrgID(tid), orgrole.KindEQ(orgrole.KindGroup)).Paginate(ctx, after, first, before, last,
		ent.WithOrgRoleOrder(orderBy), ent.WithOrgRoleFilter(where.Filter))
}

// OrgRoleUsers is the resolver for the orgRoleUsers field.
func (r *queryResolver) OrgRoleUsers(ctx context.Context, roleID int, after *entgql.Cursor[int], first *int, before *entgql.Cursor[int], last *int, orderBy *ent.UserOrder, where *ent.UserWhereInput) (*ent.UserConnection, error) {
	uIds, err := r.Resource.GetRoleUserIds(ctx, roleID)
	if err != nil {
		return nil, err
	}
	return r.Client.User.Query().Where(user.IDIn(uIds...)).Paginate(ctx, after, first, before, last,
		ent.WithUserOrder(orderBy), ent.WithUserFilter(where.Filter))
}

// OrgRoles is the resolver for the orgRoles field.
func (r *queryResolver) OrgRoles(ctx context.Context, after *entgql.Cursor[int], first *int, before *entgql.Cursor[int], last *int, orderBy *ent.OrgRoleOrder, where *ent.OrgRoleWhereInput) (*ent.OrgRoleConnection, error) {
	tid, err := identity.TenantIDFromContext(ctx)
	if err != nil {
		return nil, err
	}
	return r.Client.OrgRole.Query().Where(orgrole.OrgID(tid), orgrole.KindEQ(orgrole.KindRole)).Paginate(ctx, after, first, before, last,
		ent.WithOrgRoleOrder(orderBy), ent.WithOrgRoleFilter(where.Filter))
}
